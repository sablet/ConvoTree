# クラスタ横断上位意図（super_intent）の評価

## 実行日時
2025-11-12

## 結果サマリー

- **total_meta_intents**: 117件
- **total_individual_intents**: 705件
- **super_intents**: 14件

### 全14件のリスト

```
 1. 旅行・アウトドア活動を快適に計画・実行したい (13件)
 2. 日常生活の質と自己管理を向上したい (18件)
 3. 身体と精神の健康を維持・改善したい (5件)
 4. 思考と情報を構造化し活用したい (8件)
 5. タスクアプリの機能とUXを改善したい (14件)
 6. LLM活用とエージェント開発を推進したい (15件)
 7. 開発環境と基盤を整備・改善したい (6件)
 8. アルゴトレードシステムを構築・運用したい (10件)
 9. アルゴトレード開発の品質と管理を改善したい (3件)
10. NISA口座の振替を検討したい (1件)
11. DTNモデル開発とデータ分析を推進したい (5件)
12. DTN開発プロセスとコード管理を改善したい (6件)
13. システム・アプリの機能と品質を改善したい (4件)
14. 開発プロセスとコード品質を改善したい (9件)
```

## ゴールツリーのルートとしての評価

### ✅ 改善された点

#### 1. **簡潔性の向上**
**以前**:
```
"タスク開発アプリにおける思考・情報構造化とLLM/AI連携による高度な情報処理機能を実現したい"
```

**現在**:
```
"LLM活用とエージェント開発を推進したい" (26文字)
"タスクアプリの機能とUXを改善したい" (19文字)
```
→ 過度な修飾語と並列列挙が解消され、読みやすい

#### 2. **焦点の明確化**
**以前**: 複数の概念を1つに統合（例: 情報構造化 + LLM/AI連携）

**現在**: 単一テーマに分割
- 4. 思考と情報を構造化し活用したい
- 6. LLM活用とエージェント開発を推進したい
- 5. タスクアプリの機能とUXを改善したい

#### 3. **プロジェクト特化と汎用化のバランス**
- プロジェクト特化: 5, 8, 9, 11, 12（タスクアプリ、アルゴトレード、DTN）
- 汎用化: 6, 7, 13, 14（LLM活用、開発環境、品質改善）
- 個人生活: 1, 2, 3（旅行、日常、健康）

### ❌ 残る問題点

#### 問題1: 過度な粒度の差（1件 vs 18件）

```
10. NISA口座の振替を検討したい (1件)
 2. 日常生活の質と自己管理を向上したい (18件)
```

**問題**:
- 1件のmeta_intentしかカバーしないsuper_intentは、ゴールツリーのルートとして意味があるのか？
- 18件をカバーする「日常生活の質」は抽象度が高すぎるのでは？

**原因**:
- LLMが「グループ化できないものは単独で」という指示に従った結果
- 「日常生活」という括りが広すぎる

#### 問題2: 13と14の重複・曖昧な境界

```
13. システム・アプリの機能と品質を改善したい (4件)
    - タスク/プロジェクト管理の自動化
    - 情報基盤の収集と正規化
    - システム・アプリの機能と品質を改善したい ← meta_intentと同名
    - UI/UXとプロトタイプを評価改善する

14. 開発プロセスとコード品質を改善したい (9件)
    - 開発支援スクリプトの作成
    - 開発ツールの設定とセキュリティ理解
    - コード品質を静的解析で向上させたい
    - ...
```

**問題**:
- 13と14の境界が曖昧（どちらも「開発の品質改善」）
- 13に含まれる「システム・アプリの機能と品質を改善したい」はsuper_intentとmeta_intentが同名

**原因**:
- meta_intentレベルで既に抽象的だったものが、そのままsuper_intentになった
- 「システム改善」vs「プロセス改善」の区別が不明確

#### 問題3: objective_factsとcontextの具体性

**例**: super_intent #2「日常生活の質と自己管理を向上したい」
```json
{
  "objective_facts": "朝のドーパミン刺激、セキュリティ・家計・報酬の改善、賃貸契約更新、AI不況への不安、個人的なタスクの未完了、飲食店利用の不満、胃もたれ、税金計算など、多岐にわたる生活課題。",
  "context": "朝からアニメを見る検討、開放感を重視、快適な生活のための居住地選定、キャリアパス、経済的安定、自己の生活全般をより良くする意図。"
}
```

**問題**:
- objective_factsが列挙形式になり、「簡潔」という制約を満たしていない
- むしろ、以前のdescriptionより情報密度が高い可能性

**原因**:
- LLMが「objective_factsには事実を列挙すべき」と解釈
- 「簡潔」の定義が不明確（文字数制約なし）

## ゴールツリーのルートとしての妥当性評価

### 妥当性: **60点/100点**

#### 妥当な部分（+60点）
1. **生活領域の分離**: 旅行、日常、健康、開発が明確に分かれている
2. **プロジェクトの識別**: タスクアプリ、アルゴトレード、DTNが独立している
3. **簡潔性**: 以前より大幅に改善（30文字以内のものが多い）
4. **焦点の明確化**: 複数概念の並列列挙が減少

#### 不適切な部分（-40点）
1. **粒度の不均一**: 1件 vs 18件のカバー範囲
2. **抽象度の不適切**: 「日常生活の質」は広すぎる
3. **重複・曖昧**: 13と14の境界不明確
4. **1件ルートの存在**: NISA口座振替（単独タスクレベル）

## 改善方針案

### 方針1: 最小カバー数の制約（推奨）

**プロンプト修正**:
```markdown
## グループ化制約

- **最小カバー数**: 1つのグループは最低2件以上のmeta_intentをカバーすること
- **単独意図の扱い**: カバー数1件の場合、より広いテーマに統合するか、そのmeta_intentをsuper_intentのルートとして採用する
```

**効果**:
- 「NISA口座の振替」のような単独タスクが排除される
- より意味のある統合が促進される

### 方針2: 最大カバー数の制約

**プロンプト修正**:
```markdown
- **最大カバー数**: 1つのグループが10件以上のmeta_intentをカバーする場合、さらに細分化を検討すること
```

**効果**:
- 「日常生活の質」（18件）のような広すぎるグループが分割される
- 例: 「経済・キャリア管理」「住環境の最適化」「日常の小さな改善」など

### 方針3: objective_facts/contextの文字数制約

**プロンプト修正**:
```markdown
## 出力フィールドの制約

- **group_name**: 最大30文字
- **objective_facts**: 最大100文字（簡潔な事実のみ、列挙禁止）
- **context**: 最大100文字（核心的な背景のみ）
```

**効果**:
- 列挙形式のobjective_factsを防ぐ
- 真に簡潔な要約を強制

### 方針4: 重複チェックの強化（Pythonコード側）

**実装案**:
```python
def detect_overlap(super_intents: List[Dict]) -> List[tuple]:
    """
    super_intent間の重複を検出

    例: 「システム改善」と「開発プロセス改善」
    """
    overlaps = []
    for i, si1 in enumerate(super_intents):
        for j, si2 in enumerate(super_intents[i+1:], i+1):
            # コサイン類似度やキーワード重複で判定
            similarity = calculate_similarity(si1['super_intent'], si2['super_intent'])
            if similarity > 0.7:
                overlaps.append((i, j, similarity))
    return overlaps
```

**効果**:
- 13と14のような曖昧な境界を自動検出
- 統合や再グループ化の提案

## 次のアクション候補

### オプションA: プロンプト微調整のみ（軽量）
1. 最小/最大カバー数制約を追加
2. objective_facts/contextの文字数制約を追加
3. 再実行して比較

### オプションB: 後処理での調整（中程度）
1. 現在の出力をベースに、Pythonコードで後処理
2. カバー数1件のものを統合
3. カバー数15件以上のものを分割検討
4. 重複検出と統合提案

### オプションC: meta_intentの見直し（重量級）
1. meta_intentレベルで既に抽象的すぎるものを特定
2. 個別intentからのグループ化ロジックを見直し
3. 3階層全体を再設計

## 総合評価

### 改善の成果
- **簡潔性**: ◎（大幅改善）
- **焦点の明確性**: ◎（並列列挙が解消）
- **構造の一貫性**: ◎（objective_facts/context統一）

### 残る課題
- **粒度の均一性**: △（1件〜18件のばらつき）
- **抽象度の適切性**: △（広すぎる/狭すぎるの混在）
- **重複の排除**: △（13と14の曖昧な境界）

### 推奨アクション
**オプションA（プロンプト微調整）を推奨**

理由:
- 最小コストで大きな改善が期待できる
- 現在の方向性（簡潔性・焦点明確化）は正しい
- 微調整で粒度の問題を解決できる可能性が高い
