# メッセージ群からのGoal抽出

## タスク概要

以下のメッセージ群から、**「達成・解決しようとしている目的・意図」**を抽出してください。

## 基本原則

**Goal抽出 = 「目的・意図」を見つけること**

- **subject + theme が核心**: この2つで「何についての、どういう目的か」を表現
- **action/target/issue/conditions は補足**: 目的を詳しく説明する修飾要素（明示されている場合のみ抽出）
- **目的がないものは抽出しない**: 事実の報告、感想、雑談などは対象外

### 抽出判断フロー

```
1. 目的・意図はあるか？ → NO なら抽出しない
2. subject + theme で自然に表現できるか？ → NO なら抽出しない
3. 補足情報を抽出（メッセージに明示されている場合のみ）
```

**重要**: 行動や課題があっても、**目的が不明なら抽出しない**

---

## Goal Item Schema

### 【核心】目的・意図を表現

#### subject (必須)
**何についての目的か**: 主題を名詞句で表現

- 具体的に（「ネットワーク」→「ネットワーク図の正確性」）
- themeと組み合わせて目的が明確になるように

**例:**
- ○ 'タスク管理システムの精度'
- × 'コア概念把握' ← 行動であり主題ではない

#### theme (必須)
**どういう目的か**: 取り組む観点・意図

- subject + theme で自然な日本語として成立することが必須
- 結果ではなく、取り組む理由や動機

**例:**
- 'ネットワーク図の正確性' + '検証と信頼性の確保' = 「ネットワーク図の正確性について、検証と信頼性の確保に取り組む」
- × 'ネットワーク図' + 'コア概念把握、安定性' ← 日本語として不自然

---

### 【補足情報】目的を詳しく説明

**重要**: 以下は目的があって初めて意味を持つ補足。メッセージに明示されている場合のみ抽出（推測で埋めない）

#### action (配列)
目的達成の手段。動詞で表現。明示されていなければ空配列 `[]`

- ○ ['構造を読み取る', '検証する']
- × ['安定性を増す'] ← 結果であり行動ではない

#### target (配列)
行動の対象。actionの目的語。

- ○ [{{"name": "ネットワーク図の構造", "outcome": ["ProblemSolving"]}}]
- × [{{"name": "コア概念把握"}}] ← 行動であり対象ではない

**outcome選択肢**: Achievement, Improvement, Learning, Efficiency, Maintenance, ProblemSolving, Emotional

#### issue (配列)
達成を阻む障壁。課題として整理。

- ○ ['図の正確性が未検証で不安がある']
- × ['ネットワーク図自体が正しいのか気になる'] ← メッセージの引用ではなく課題として整理

#### conditions (配列)
背景・前提。問題ではなくニュートラルな事実。

- ○ ['構造ベースの判断が可能']
- × ['構造を読み取ってそれを元に判断するだけなので'] ← メッセージの一部ではなく整理

---

### その他のフィールド

#### abstraction_level (必須)
目的の抽象度レイヤー。以下から1つ選択:

- L1_人生目的: 価値観・哲学
- L2_大目標: 長期的テーマ
- L3_プロジェクト: 中期的プロジェクト
- L4_サブゴール: 短期的サブゴール
- L5_タスク: 具体的タスク

#### domain (配列)
目的が属する分野。複数選択可:

ビジネス, マーケティング, 技術開発, 生産性, 人材組織, 健康, 家事生活, 人間関係, 資産管理, 趣味娯楽, 学習, メタ思考

#### meta (オブジェクト)
任意のメタ情報。空オブジェクト `{{}}` も可。

#### source_message_ids (配列、必須)
元になったメッセージIDのリスト。必ず1つ以上含めること。

---

## 抽出例

### 例1: 適切な抽出

**元メッセージ:**
```
ネットワーク図自体が正しいのか気になる。構造を読み取ってそれを元に判断するだけなので、コア概念把握、安定性を増す
```

**❌ 不適切:**
```json
{{
  "subject": "ネットワーク図",
  "theme": "コア概念把握、安定性",
  "action": ["安定性を増す"]
}}
```
→ subject+themeが不自然、actionが結果

**✅ 適切:**
```json
{{
  "subject": "ネットワーク図の正確性",
  "theme": "検証と信頼性の確保",
  "action": ["構造を読み取る", "判断基準に照らして評価する"],
  "target": [{{"name": "ネットワーク図の構造", "outcome": ["ProblemSolving"]}}],
  "issue": ["図の正確性が未検証で不安がある"],
  "conditions": ["構造ベースの判断が可能である"],
  "abstraction_level": "L4_サブゴール",
  "domain": ["技術開発", "メタ思考"],
  "meta": {{"note": "副次効果としてコア概念把握と安定性向上が期待される"}},
  "source_message_ids": ["msg_xxxxx"]
}}
```

---

### 例2: 複数の意図を分割

**元メッセージ:**
```
トピックは自然言語で選べるようにもしたいが、トピックリスト一覧をボタン押したら見られるようにもしたい。
```

**✅ 適切（2つに分割）:**

GoalItem 1: subject: 'トピック選択UI' + theme: '自然言語入力の実装'
GoalItem 2: subject: 'トピックリスト表示' + theme: 'ボタンによる一覧確認機能'

→ 独立した2つの目的なので分割

---

### 例3: 目的がないケース（抽出しない）

**❌ 抽出しない例:**

**事実の報告:**
```
今日は3つのタスクを完了した。テストも全部パスした。
```
→ 過去の事実であり、これから達成する目的がない

**感想:**
```
このライブラリは使いやすい。
```
→ 評価であり、達成しようとする目的がない

**行動があるが目的不明:**
```
ファイルを整理した。
```
→ 「何のために」が不明

**✅ 抽出する例（比較）:**

```
次は認証機能を実装したい。セキュリティを強化する必要がある。
```
→ subject: '認証機能' + theme: 'セキュリティ強化の実装' という明確な目的

---

## メッセージ一覧

{messages}

---

## 抽出タスク

上記のメッセージ群を分析し、GoalItemオブジェクトのリストをJSON形式で抽出してください。

### 出力形式

```json
[
  {{
    "subject": "...",
    "theme": "...",
    "action": [...],
    "target": [...],
    "issue": [...],
    "conditions": [...],
    "abstraction_level": "L4_サブゴール",
    "domain": [...],
    "meta": {{}},
    "source_message_ids": ["msg_xxxxx"]
  }}
]
```

### 重要な注意事項

**抽出前チェック:**
1. 目的・意図はあるか？ → NO なら抽出しない
2. subject + theme で自然に表現できるか？ → NO なら抽出しない

**必須:**
- 純粋なJSON配列のみ出力（説明文・コメント禁止）
- subject/theme必須、自然な日本語の組み合わせ
- abstraction_level必須
- source_message_ids必須（1つ以上）
- 補足情報は明示されている場合のみ（推測で埋めない、空配列OK）

**禁止:**
- 目的がないメッセージを抽出
- 行動や課題があるだけで抽出
- メッセージの文言をそのまま切り出す
- 結果を action に含める
- 行動を target に含める
- 複数の目的を1つにまとめる
