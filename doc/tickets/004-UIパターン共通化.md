# Ticket #004: UIパターン共通化

## 概要
類似したUIコンポーネントパターンが複数箇所で重複している問題を解決するため、再利用可能なUIコンポーネントを作成する。

## 背景
jscpdによるコピペ検出で以下のUI関連重複が検出された：

### 重複パターン: メニューコンポーネント
- `app/branch_list/page.tsx:169-180` ↔ `components/line-history-menu.tsx:63-74` (11行, 76トークン)

この重複は、おそらく以下のような類似UIパターンに関連していると推測される：
- ドロップダウンメニューの構造
- ボタンアクションパターン
- アイコン + テキストの組み合わせ
- フォーム要素の配置

## 目標
- UIコンポーネントの重複を排除
- 再利用可能なUIパターンコンポーネント作成
- デザインシステムの基盤確立

## 実装タスク

### 1. 重複箇所の詳細調査

**調査対象**:
- `app/branch_list/page.tsx:169-180`
- `components/line-history-menu.tsx:63-74`

**調査内容**:
- 重複している具体的なコード内容
- UI要素の共通パターン分析
- 抽象化可能な部分の特定

### 2. 共通UIコンポーネント作成

**推定される共通化候補**:

**ファイル**: `components/ui/menu-item.tsx`
```typescript
interface MenuItemProps {
  icon?: React.ReactNode
  label: string
  onClick: () => void
  variant?: 'default' | 'danger'
  disabled?: boolean
}

export function MenuItem({ icon, label, onClick, variant = 'default', disabled }: MenuItemProps) {
  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={cn(
        "flex items-center gap-2 w-full px-3 py-2 text-sm rounded-md transition-colors",
        "hover:bg-muted focus:bg-muted",
        variant === 'danger' && "text-destructive hover:bg-destructive/10",
        disabled && "opacity-50 cursor-not-allowed"
      )}
    >
      {icon}
      <span>{label}</span>
    </button>
  )
}
```

**ファイル**: `components/ui/action-menu.tsx`
```typescript
interface ActionMenuProps {
  children: React.ReactNode
  trigger?: React.ReactNode
}

export function ActionMenu({ children, trigger }: ActionMenuProps) {
  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        {trigger || <Button variant="outline" size="sm">...</Button>}
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        {children}
      </DropdownMenuContent>
    </DropdownMenu>
  )
}
```

### 3. 既存コンポーネントの修正

**対象ファイル**:
- `app/branch_list/page.tsx` (該当部分)
- `components/line-history-menu.tsx` (該当部分)

**修正内容**:
1. 重複しているUI構造コードを削除
2. 新しい共通UIコンポーネントを import
3. プロパティベースの設定に変更

### 4. その他のUI改善

**追加で共通化できる可能性のあるパターン**:
- Loading状態の表示
- Empty状態の表示
- Error状態の表示
- 確認ダイアログ
- トースト通知

### 5. 検証
- 既存の機能が正常に動作することを確認
- UIの見た目が維持されることを確認
- `npm run cpd-check` でUI関連重複が削減されることを確認

## 受け入れ条件
- [ ] 重複している具体的なコード内容が特定されている
- [ ] 適切な共通UIコンポーネントが作成されている
- [ ] 既存ファイルから重複コードが削除されている
- [ ] UIの見た目と機能が維持されている
- [ ] TypeScriptビルドが成功する
- [ ] jscpdでUI関連重複が削減される

## 注意事項
- 既存のデザインを維持する
- アクセシビリティを考慮する
- 過度な抽象化は避ける

## 優先度
Low - 明確な重複が少ないため優先度は低い

## 推定作業時間
60分

## 依存関係
- 詳細調査の結果によって実装内容が決まる

## 関連チケット
- #001: 共通型定義ファイル作成
- #002: 時間ユーティリティ関数共通化
- #003: ページコンポーネント共通化

## 備考
このチケットは重複箇所の詳細調査から開始し、実際の重複内容に応じて実装方針を調整する必要がある。