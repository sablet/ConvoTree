# デバッグ・問題解決の原則

## 原則1: 症状から原因を決めつけない

**アンチパターン:**
```
「キャッシュが効かない」→「キャッシュ機構に問題がある」→ 複雑な実装を追加
```

**正しいアプローチ:**
```
「キャッシュが効かない」→「何がキャッシュを壊しているか？」→ 不要な処理を削除
```

症状は同じでも、原因は「機能不足」と「余計な処理」の両方がありうる。後者を見落とさない。

## 原則2: 既存コードを批判的に検証する

コードレビュー時の質問：
- **なぜこの処理があるのか？**
- **本当に必要か？**
- **削除したらどうなるか？**

特に以下のパターンは疑う：
- `clearCache()` / `reset()` などのクリーンアップ処理
- 広範囲に影響する状態更新
- 「念のため」で追加された処理

## 原則3: シンプルな解決を優先する

**判断基準:**
1. 既存の処理を削除できないか？
2. 設定変更で解決できないか？
3. 最小限の修正で済まないか？
4. 新機能の追加が本当に必要か？（最後の手段）

**実例:** 今回のケース
- 誤: timestamp ベースの差分取得を実装（200行以上の追加）
- 正: `clearAllCache()` の呼び出しを削除（8行の削除）

## 原則4: 「追加」だけでなく「削除」の視点を持つ

問題解決 ≠ 機能追加

- 「足りないから追加」より先に「余計だから削除」を検討
- オプティミスティック更新後のキャッシュクリアは不要なことが多い
- 状態管理のフレームワーク（Repository パターンなど）に任せる

## チェックリスト

問題に直面したら：

- [ ] 既存のクリーンアップ処理が原因ではないか？
- [ ] 状態更新の順序・タイミングに問題はないか？
- [ ] フレームワークの機能を壊していないか？
- [ ] 「念のため」で追加された処理を疑ったか？
- [ ] シンプルな解決（削除・設定変更）を検討したか？

## 関連ドキュメント

- `repository-pattern-guide.md` - Repository のキャッシュ管理
- `architecture-enforcement.md` - アーキテクチャの責務分離
